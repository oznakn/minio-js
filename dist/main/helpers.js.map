{"version":3,"sources":["helpers.js"],"names":["Crypto","require","ipaddr","fs","path","promisify","fn","callback","arguments","length","apply","args","Promise","resolve","reject","push","err","value","uriEscape","string","split","reduce","acc","elem","buf","Buffer","from","i","toString","toUpperCase","uriResourceEscape","replace","getScope","region","date","makeDateShort","isAmazonEndpoint","endpoint","isVirtualHostStyle","protocol","bucket","pathStyle","indexOf","isValidIP","ip","isValid","isValidEndpoint","isValidDomain","host","isString","substr","alphaNumerics","probeContentType","contentType","mime","lookup","isValidPort","port","isNumber","min_port","max_port","isValidBucketName","match","isValidObjectName","objectName","isValidPrefix","prefix","arg","isFunction","isObject","isReadableStream","_read","isBoolean","isArray","Array","isValidDate","Date","isNaN","makeDateLong","toISOString","pipesetup","streams","src","dst","on","emit","pipe","readableStream","data","s","stream","Readable","insertContentType","metaData","filePath","key","toLowerCase","newMetadata","Object","assign","prependXAMZMeta","isAmzHeader","isSupportedHeader","isStorageclassHeader","temp","startsWith","supported_headers","extractMetadata","slice","getVersionId","headers","versionIdValue","getSourceVersionId","sourceVersionId","sanitizeETag","etag","replaceChars","m","RETENTION_MODES","GOVERNANCE","COMPLIANCE","RETENTION_VALIDITY_UNITS","DAYS","YEARS","LEGAL_HOLD_STATUS","ENABLED","DISABLED","objectToBuffer","payload","payloadBuf","toMd5","payLoadBuf","isBrowser","createHash","update","digest","toSha256","toArray","param","sanitizeObjectKey","asStrName","sanitizedName","decodeURIComponent","PART_CONSTRAINTS","ABS_MIN_PART_SIZE","MIN_PART_SIZE","MAX_PARTS_COUNT","MAX_PART_SIZE","MAX_SINGLE_PUT_OBJECT_SIZE","MAX_MULTIPART_PUT_OBJECT_SIZE","ENCRYPTION_TYPES","SSEC","KMS","GENERIC_SSE_HEADER","ENCRYPTION_HEADERS","sseGenericHeader","sseKmsKeyID","getEncryptionHeaders","encConfig","encType","type","encHeaders","_","isEmpty","SSEAlgorithm","KMSMasterKeyID","CopySourceOptions","Bucket","VersionID","MatchETag","NoMatchETag","MatchModifiedSince","MatchUnmodifiedSince","MatchRange","Start","End","Encryption","errors","InvalidBucketNameError","InvalidObjectNameError","headerOptions","encodeURI","CopyDestinationOptions","UserMetadata","UserTags","LegalHold","RetainUntilDate","Mode","replaceDirective","userTags","querystring","stringify","headerKeys","keys","forEach","encryptionHeaders","includes","partsRequired","size","maxPartSize","requiredPartSize","Math","trunc","startIndexParts","endIndexParts","calculateEvenSplits","objInfo","reqParts","start","divisorValue","reminderValue","nextStart","curPartSize","currentStart","currentEnd","startIndex","endIndex","removeDirAndFiles","dirPath","removeSelf","undefined","files","readdirSync","e","join","statSync","isFile","unlinkSync","rmdirSync"],"mappings":"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","sourcesContent":["/*\n * MinIO Javascript Library for Amazon S3 Compatible Cloud Storage, (C) 2015 MinIO, Inc.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport stream from 'stream'\nimport mime from 'mime-types'\nvar Crypto = require('crypto-browserify')\nconst ipaddr = require('ipaddr.js')\nimport { isBrowser } from \"browser-or-node\"\n\nconst fs = require('fs')\nconst path = require(\"path\")\nimport _ from 'lodash'\nimport * as errors from './errors.js'\nimport querystring from \"querystring\"\n\n// Returns a wrapper function that will promisify a given callback function.\n// It will preserve 'this'.\nexport function promisify(fn) {\n  return function() {\n    // If the last argument is a function, assume its the callback.\n    let callback = arguments[arguments.length - 1]\n\n    // If the callback is given, don't promisify, just pass straight in.\n    if (typeof callback === 'function') return fn.apply(this, arguments)\n\n    // Otherwise, create a new set of arguments, and wrap\n    // it in a promise.\n    let args = [...arguments]\n\n    return new Promise((resolve, reject) => {\n      // Add the callback function.\n      args.push((err, value) => {\n        if (err) return reject(err)\n\n        resolve(value)\n      })\n\n      // Call the function with our special adaptor callback added.\n      fn.apply(this, args)\n    })\n  }\n}\n\n// All characters in string which are NOT unreserved should be percent encoded.\n// Unreserved characers are : ALPHA / DIGIT / \"-\" / \".\" / \"_\" / \"~\"\n// Reference https://tools.ietf.org/html/rfc3986#section-2.2\nexport function uriEscape(string) {\n  return string.split('').reduce((acc, elem) => {\n    let buf = Buffer.from(elem)\n    if (buf.length === 1) {\n      // length 1 indicates that elem is not a unicode character.\n      // Check if it is an unreserved characer.\n      if ('A' <= elem && elem <= 'Z' ||\n          'a' <= elem && elem <= 'z' ||\n          '0' <= elem && elem <= '9' ||\n          elem === '_' ||\n          elem === '.' ||\n          elem === '~' ||\n          elem === '-')\n      {\n        // Unreserved characer should not be encoded.\n        acc = acc + elem\n        return acc\n      }\n    }\n    // elem needs encoding - i.e elem should be encoded if it's not unreserved\n    // character or if it's a unicode character.\n    for (var i = 0; i < buf.length; i++) {\n      acc = acc + \"%\" + buf[i].toString(16).toUpperCase()\n    }\n    return acc\n  }, '')\n}\n\nexport function uriResourceEscape(string) {\n  return uriEscape(string).replace(/%2F/g, '/')\n}\n\nexport function getScope(region, date) {\n  return `${makeDateShort(date)}/${region}/s3/aws4_request`\n}\n\n// isAmazonEndpoint - true if endpoint is 's3.amazonaws.com' or 's3.cn-north-1.amazonaws.com.cn'\nexport function isAmazonEndpoint(endpoint) {\n  return endpoint === 's3.amazonaws.com' || endpoint === 's3.cn-north-1.amazonaws.com.cn'\n}\n\n// isVirtualHostStyle - verify if bucket name is support with virtual\n// hosts. bucketNames with periods should be always treated as path\n// style if the protocol is 'https:', this is due to SSL wildcard\n// limitation. For all other buckets and Amazon S3 endpoint we will\n// default to virtual host style.\nexport function isVirtualHostStyle(endpoint, protocol, bucket, pathStyle) {\n  if (protocol === 'https:' && bucket.indexOf('.') > -1) {\n    return false\n  }\n  return isAmazonEndpoint(endpoint) || !pathStyle\n}\n\n\nexport function isValidIP(ip) {\n  return ipaddr.isValid(ip)\n}\n\n// isValidEndpoint - true if endpoint is valid domain.\nexport function isValidEndpoint(endpoint) {\n  return isValidDomain(endpoint) || isValidIP(endpoint)\n}\n\n// isValidDomain - true if input host is a valid domain.\nexport function isValidDomain(host) {\n  if (!isString(host)) return false\n  // See RFC 1035, RFC 3696.\n  if (host.length === 0 || host.length > 255) {\n    return false\n  }\n  // Host cannot start or end with a '-'\n  if (host[0] === '-' || host.substr(-1) === '-') {\n    return false\n  }\n  // Host cannot start or end with a '_'\n  if (host[0] === '_' || host.substr(-1) === '_') {\n    return false\n  }\n  // Host cannot start with a '.'\n  if (host[0] === '.') {\n    return false\n  }\n  var alphaNumerics = '`~!@#$%^&*()+={}[]|\\\\\"\\';:><?/'.split('')\n  // All non alphanumeric characters are invalid.\n  for (var i in alphaNumerics) {\n    if (host.indexOf(alphaNumerics[i]) > -1) {\n      return false\n    }\n  }\n  // No need to regexp match, since the list is non-exhaustive.\n  // We let it be valid and fail later.\n  return true\n}\n\n// Probes contentType using file extensions.\n// For example: probeContentType('file.png') returns 'image/png'.\nexport function probeContentType(path) {\n  let contentType = mime.lookup(path)\n  if (!contentType) {\n    contentType = 'application/octet-stream'\n  }\n  return contentType\n}\n\n// isValidPort - is input port valid.\nexport function isValidPort(port) {\n  // verify if port is a number.\n  if (!isNumber(port)) return false\n  // port cannot be negative.\n  if (port < 0) return false\n  // port '0' is valid and special case return true.\n  if (port === 0) return true\n  var min_port = 1\n  var max_port = 65535\n  // Verify if port is in range.\n  return port >= min_port && port <= max_port\n}\n\nexport function isValidBucketName(bucket) {\n  if (!isString(bucket)) return false\n\n  // bucket length should be less than and no more than 63\n  // characters long.\n  if (bucket.length < 3 || bucket.length > 63) {\n    return false\n  }\n  // bucket with successive periods is invalid.\n  if (bucket.indexOf('..') > -1) {\n    return false\n  }\n  // bucket cannot have ip address style.\n  if (bucket.match(/[0-9]+\\.[0-9]+\\.[0-9]+\\.[0-9]+/)) {\n    return false\n  }\n  // bucket should begin with alphabet/number and end with alphabet/number,\n  // with alphabet/number/.- in the middle.\n  if (bucket.match(/^[a-z0-9][a-z0-9.-]+[a-z0-9]$/)) {\n    return true\n  }\n  return false\n}\n\n// check if objectName is a valid object name\nexport function isValidObjectName(objectName) {\n  if (!isValidPrefix(objectName)) return false\n  if (objectName.length === 0) return false\n  return true\n}\n\n// check if prefix is valid\nexport function isValidPrefix(prefix) {\n  if (!isString(prefix)) return false\n  if (prefix.length > 1024) return false\n  return true\n}\n\n// check if typeof arg number\nexport function isNumber(arg) {\n  return typeof(arg) === 'number'\n}\n\n// check if typeof arg function\nexport function isFunction(arg) {\n  return typeof(arg) === 'function'\n}\n\n// check if typeof arg string\nexport function isString(arg) {\n  return typeof(arg) === 'string'\n}\n\n// check if typeof arg object\nexport function isObject(arg) {\n  return typeof(arg) === 'object' && arg !== null\n}\n\n// check if object is readable stream\nexport function isReadableStream(arg) {\n  return isObject(arg) && isFunction(arg._read)\n}\n\n// check if arg is boolean\nexport function isBoolean(arg) {\n  return typeof(arg) === 'boolean'\n}\n\n// check if arg is array\nexport function isArray(arg) {\n  return Array.isArray(arg)\n}\n\n// check if arg is a valid date\nexport function isValidDate(arg) {\n  return arg instanceof Date && !isNaN(arg)\n}\n\n// Create a Date string with format:\n// 'YYYYMMDDTHHmmss' + Z\nexport function makeDateLong(date) {\n  date = date || new Date()\n\n  // Gives format like: '2017-08-07T16:28:59.889Z'\n  date = date.toISOString()\n\n  return date.substr(0, 4) +\n    date.substr(5, 2) +\n    date.substr(8, 5) +\n    date.substr(14, 2) +\n    date.substr(17, 2) + 'Z'\n}\n\n// Create a Date string with format:\n// 'YYYYMMDD'\nexport function makeDateShort(date) {\n  date = date || new Date()\n\n  // Gives format like: '2017-08-07T16:28:59.889Z'\n  date = date.toISOString()\n\n  return date.substr(0, 4) +\n    date.substr(5, 2) +\n    date.substr(8, 2)\n}\n\n// pipesetup sets up pipe() from left to right os streams array\n// pipesetup will also make sure that error emitted at any of the upstream Stream\n// will be emitted at the last stream. This makes error handling simple\nexport function pipesetup(...streams) {\n  return streams.reduce((src, dst) => {\n    src.on('error', err => dst.emit('error', err))\n    return src.pipe(dst)\n  })\n}\n\n// return a Readable stream that emits data\nexport function readableStream(data) {\n  var s = new stream.Readable()\n  s._read = () => {}\n  s.push(data)\n  s.push(null)\n  return s\n}\n\n// Process metadata to insert appropriate value to `content-type` attribute\nexport function insertContentType(metaData, filePath) {\n  // check if content-type attribute present in metaData\n  for (var key in metaData) {\n    if (key.toLowerCase() === 'content-type') {\n      return metaData\n    }\n  }\n  // if `content-type` attribute is not present in metadata,\n  // then infer it from the extension in filePath\n  var newMetadata = Object.assign({}, metaData)\n  newMetadata['content-type'] = probeContentType(filePath)\n  return newMetadata\n}\n\n// Function prepends metadata with the appropriate prefix if it is not already on\nexport function prependXAMZMeta(metaData) {\n  var newMetadata = Object.assign({}, metaData)\n  for (var key in metaData) {\n    if(!isAmzHeader(key) && !isSupportedHeader(key) && !isStorageclassHeader(key)) {\n      newMetadata[\"X-Amz-Meta-\" + key ] = newMetadata[key]\n      delete newMetadata[key]\n    }\n  }\n  return newMetadata\n}\n\n// Checks if it is a valid header according to the AmazonS3 API\nexport function isAmzHeader(key) {\n  var temp = key.toLowerCase()\n  return temp.startsWith(\"x-amz-meta-\") || temp === \"x-amz-acl\" || temp.startsWith(\"x-amz-server-side-encryption-\") || temp === \"x-amz-server-side-encryption\"\n}\n// Checks if it is a supported Header\nexport function isSupportedHeader(key) {\n  var supported_headers = [\n    'content-type',\n    'cache-control',\n    'content-encoding',\n    'content-disposition',\n    'content-language',\n    'x-amz-website-redirect-location']\n  return (supported_headers.indexOf(key.toLowerCase()) > -1)\n}\n// Checks if it is a storage header\nexport function isStorageclassHeader(key) {\n  return key.toLowerCase() === \"x-amz-storage-class\"\n}\n\nexport function extractMetadata(metaData) {\n  var newMetadata = {}\n  for (var key in metaData) {\n    if(isSupportedHeader(key) || isStorageclassHeader(key) || isAmzHeader(key)) {\n      if(key.toLowerCase().startsWith(\"x-amz-meta-\")) {\n        newMetadata[key.slice(11,key.length)] = metaData[key]\n      } else {\n        newMetadata[key] = metaData[key]\n      }\n    }\n  }\n  return newMetadata\n}\n\n\nexport function getVersionId(headers={}){\n  const versionIdValue = headers[\"x-amz-version-id\"]\n  return  versionIdValue || null\n}\n\nexport function getSourceVersionId(headers={}){\n  const sourceVersionId = headers[\"x-amz-copy-source-version-id\"]\n  return  sourceVersionId || null\n}\n\nexport function sanitizeETag(etag='') {\n  var replaceChars = {'\"':'','&quot;':'','&#34;':'','&QUOT;':'','&#x00022':''}\n  return etag.replace(/^(\"|&quot;|&#34;)|(\"|&quot;|&#34;)$/g, m => replaceChars[m])\n    \n}\n\nexport const RETENTION_MODES ={\n  GOVERNANCE:\"GOVERNANCE\",\n  COMPLIANCE:\"COMPLIANCE\"\n}\n\nexport const RETENTION_VALIDITY_UNITS={\n  DAYS:\"Days\",\n  YEARS:\"Years\"\n}\n\nexport const LEGAL_HOLD_STATUS={\n  ENABLED:\"ON\",\n  DISABLED:\"OFF\"\n}\n\nconst objectToBuffer = (payload) =>{\n  const payloadBuf = Buffer.from(Buffer.from(payload))\n  return payloadBuf\n}\n\nexport const toMd5=(payload)=>{\n  let payLoadBuf = objectToBuffer(payload)\n  // use string from browser and buffer from nodejs\n  // browser support is tested only against minio server\n  payLoadBuf = isBrowser ? payLoadBuf.toString() : payLoadBuf\n  return Crypto.createHash('md5').update(payLoadBuf).digest().toString('base64')\n}\n\nexport const toSha256=(payload)=>{\n  return Crypto.createHash('sha256').update(payload).digest('hex')\n}\n\n// toArray returns a single element array with param being the element,\n// if param is just a string, and returns 'param' back if it is an array\n// So, it makes sure param is always an array\nexport const toArray = (param) => {\n  if (!Array.isArray(param)) {\n    return Array(param)\n  }\n  return param\n}\n\nexport const sanitizeObjectKey=(objectName)=>{\n  // + symbol characters are not decoded as spaces in JS. so replace them first and decode to get the correct result.\n  let asStrName= (objectName || \"\").replace(/\\+/g, ' ')\n  const sanitizedName = decodeURIComponent(asStrName)\n  return sanitizedName\n}\n\n\nexport const PART_CONSTRAINTS ={\n// absMinPartSize - absolute minimum part size (5 MiB)\n  ABS_MIN_PART_SIZE:1024 * 1024 * 5,\n  // MIN_PART_SIZE - minimum part size 16MiB per object after which\n  MIN_PART_SIZE : 1024 * 1024 * 16,\n  // MAX_PARTS_COUNT - maximum number of parts for a single multipart session.\n  MAX_PARTS_COUNT : 10000,\n  // MAX_PART_SIZE - maximum part size 5GiB for a single multipart upload\n  // operation.\n  MAX_PART_SIZE: 1024 * 1024 * 1024 * 5,\n  // MAX_SINGLE_PUT_OBJECT_SIZE - maximum size 5GiB of object per PUT\n  // operation.\n  MAX_SINGLE_PUT_OBJECT_SIZE: 1024 * 1024 * 1024 * 5,\n  // MAX_MULTIPART_PUT_OBJECT_SIZE - maximum size 5TiB of object for\n  // Multipart operation.\n  MAX_MULTIPART_PUT_OBJECT_SIZE: 1024 * 1024 * 1024 * 1024 * 5\n}\n\nexport const ENCRYPTION_TYPES ={\n  // SSEC represents server-side-encryption with customer provided keys\n  SSEC: \"SSE-C\",\n  // KMS represents server-side-encryption with managed keys\n  KMS: \"KMS\"\n\n}\nconst GENERIC_SSE_HEADER=\"X-Amz-Server-Side-Encryption\"\n\nconst ENCRYPTION_HEADERS ={\n  // sseGenericHeader is the AWS SSE header used for SSE-S3 and SSE-KMS.\n  sseGenericHeader : GENERIC_SSE_HEADER,\n  // sseKmsKeyID is the AWS SSE-KMS key id.\n  sseKmsKeyID : GENERIC_SSE_HEADER + \"-Aws-Kms-Key-Id\",\n}\n\n/**\n * Return Encryption headers\n * @param encConfig\n * @returns an object with key value pairs that can be used in headers.\n */\nfunction getEncryptionHeaders (encConfig) {\n  const encType = encConfig.type\n  const encHeaders = {}\n  if(!_.isEmpty(encType) ){\n    if( encType === ENCRYPTION_TYPES.SSEC) {\n      return {\n        [encHeaders[ENCRYPTION_HEADERS.sseGenericHeader]]: \"AES256\"\n      }\n    } else if(encType === ENCRYPTION_TYPES.KMS){\n      return {\n        [ENCRYPTION_HEADERS.sseGenericHeader]:encConfig.SSEAlgorithm,\n        [ENCRYPTION_HEADERS.sseKmsKeyID]:encConfig.KMSMasterKeyID\n      }\n    }\n  }\n\n  return encHeaders\n}\n\nexport class CopySourceOptions {\n  /**\n     *\n     * @param Bucket __string__ Bucket Name\n     * @param Object __string__ Object Name\n     * @param VersionID __string__ Valid versionId\n     * @param MatchETag __string__ Etag to match\n     * @param NoMatchETag __string__ Etag to exclude\n     * @param MatchModifiedSince __string__ Modified Date of the object/part.  UTC Date in string format\n     * @param MatchUnmodifiedSince __string__ Modified Date of the object/part to exclude UTC Date in string format\n     * @param MatchRange __boolean__ true or false Object range to match\n     * @param Start\n     * @param End\n     * @param Encryption\n     */\n  constructor({\n    Bucket=\"\",\n    Object=\"\",\n    VersionID=\"\",\n    MatchETag=\"\",\n    NoMatchETag=\"\",\n    MatchModifiedSince=null,\n    MatchUnmodifiedSince=null,\n    MatchRange=false,\n    Start=0,\n    End=0,\n    Encryption= {},\n  }={}) {\n\n    this.Bucket=Bucket\n    this.Object=Object\n    this.VersionID=VersionID\n    this.MatchETag=MatchETag\n    this.NoMatchETag=NoMatchETag\n    this.MatchModifiedSince=MatchModifiedSince\n    this.MatchUnmodifiedSince=MatchUnmodifiedSince\n    this.MatchRange=MatchRange\n    this.Start=Start\n    this.End=End\n    this.Encryption=Encryption\n  }\n\n  validate(){\n    if (!isValidBucketName(this.Bucket)) {\n      throw new errors.InvalidBucketNameError('Invalid Source bucket name: ' + this.Bucket)\n    }\n    if (!isValidObjectName(this.Object)) {\n      throw new errors.InvalidObjectNameError(`Invalid Source object name: ${this.Object}`)\n    }\n    if (this.MatchRange && (this.Start !==-1 && this.End !==-1) && this.Start > this.End || this.Start < 0) {\n      throw  new errors.InvalidObjectNameError(\"Source start must be non-negative, and start must be at most end.\")\n    } else if(this.MatchRange&& !isNumber(this.Start) || !isNumber(this.End) ){\n      throw  new errors.InvalidObjectNameError(\"MatchRange is specified. But  Invalid Start and End values are specified. \")\n    }\n\n    return true\n  }\n\n  getHeaders (){\n    let headerOptions ={}\n    headerOptions[\"x-amz-copy-source\"]=encodeURI(this.Bucket+\"/\"+this.Object)\n\n    if (!_.isEmpty(this.VersionID)) {\n      headerOptions[\"x-amz-copy-source\"]=encodeURI(this.Bucket+\"/\"+this.Object)+\"?versionId=\"+this.VersionID\n    }\n\n    if (!_.isEmpty(this.MatchETag)) {\n      headerOptions[\"x-amz-copy-source-if-match\"]=this.MatchETag\n    }\n    if (!_.isEmpty(this.NoMatchETag)) {\n      headerOptions[\"x-amz-copy-source-if-none-match\"]=this.NoMatchETag\n    }\n\n    if (!_.isEmpty(this.MatchModifiedSince)) {\n      headerOptions[\"x-amz-copy-source-if-modified-since\"]= this.MatchModifiedSince\n    }\n    if (!_.isEmpty(this.MatchUnmodifiedSince)) {\n      headerOptions[\"x-amz-copy-source-if-unmodified-since\"]= this.MatchUnmodifiedSince\n    }\n\n    return headerOptions\n\n  }\n}\n\nexport class CopyDestinationOptions {\n  /*\n   * @param Bucket __string__\n   * @param Object __string__ Object Name for the destination (composed/copied) object defaults\n   * @param Encryption __object__ Encryption configuration defaults to {}\n   * @param UserMetadata __object__\n   * @param UserTags __object__ | __string__\n   * @param LegalHold __string__  ON | OFF\n   * @param RetainUntilDate __string__ UTC Date String\n   * @param Mode\n  */\n  constructor({\n    Bucket=\"\",\n    Object=\"\",\n    Encryption=null,\n    UserMetadata=null,\n    UserTags=null,\n    LegalHold = null,\n    RetainUntilDate=null,\n    Mode=null, //\n  }) {\n    this.Bucket=Bucket\n    this.Object=Object\n    this.Encryption=Encryption\n    this.UserMetadata=UserMetadata\n    this.UserTags=UserTags\n    this.LegalHold = LegalHold\n    this.Mode=Mode // retention mode\n    this.RetainUntilDate=RetainUntilDate\n  }\n\n  getHeaders (){\n    const replaceDirective = \"REPLACE\"\n    const headerOptions ={}\n\n    const userTags= this.UserTags\n    if (!_.isEmpty(userTags)) {\n      headerOptions[\"X-Amz-Tagging-Directive\"]=replaceDirective\n      headerOptions[\"X-Amz-Tagging\"]=isObject(userTags)? querystring.stringify(userTags):isString(userTags)?userTags:\"\"\n    }\n\n    if (!_.isEmpty(this.Mode)) {\n      headerOptions[\"X-Amz-Object-Lock-Mode\"]=this.Mode // GOVERNANCE or COMPLIANCE\n    }\n\n    if (!_.isEmpty(this.RetainUntilDate)) {\n      headerOptions[\"X-Amz-Object-Lock-Retain-Until-Date\"]=this.RetainUntilDate// needs to be UTC.\n    }\n\n    if (!_.isEmpty(this.LegalHold) ){\n      headerOptions[\"X-Amz-Object-Lock-Legal-Hold\"]= this.LegalHold// ON or OFF\n    }\n\n    if(!_.isEmpty(this.UserMetadata)){\n      const headerKeys = Object.keys(this.UserMetadata)\n      headerKeys.forEach((key)=>{\n        headerOptions[`X-Amz-Meta-${key}`]=this.UserMetadata[key]\n      })\n\n    }\n\n    if (!_.isEmpty(this.Encryption)){\n      const encryptionHeaders = getEncryptionHeaders(this.Encryption)\n      Object.keys(encryptionHeaders).forEach((key)=>{\n        headerOptions[key]=encryptionHeaders[key]\n      })\n\n    }\n    return headerOptions\n  }\n  validate(){\n    if (!isValidBucketName(this.Bucket)) {\n      throw new errors.InvalidBucketNameError('Invalid Destination bucket name: ' + this.Bucket)\n    }\n    if (!isValidObjectName(this.Object)) {\n      throw new errors.InvalidObjectNameError(`Invalid Destination object name: ${this.Object}`)\n    }\n    if(!_.isEmpty(this.UserMetadata) && !isObject(this.UserMetadata)){\n      throw new errors.InvalidObjectNameError(`Destination UserMetadata should be an object with key value pairs`)\n    }\n\n    if(!_.isEmpty(this.Mode) && ![RETENTION_MODES.GOVERNANCE, RETENTION_MODES.COMPLIANCE].includes(this.Mode)){\n      throw new errors.InvalidObjectNameError(`Invalid Mode specified for destination object it should be one of [GOVERNANCE,COMPLIANCE]`)\n    }\n\n    if (!_.isEmpty(this.Encryption) && _.isEmpty(this.Encryption) ){\n      throw new errors.InvalidObjectNameError(`Invalid Encryption configuration for destination object `)\n    }\n    return true\n  }\n}\n\nexport const  partsRequired= (size) =>{\n  let maxPartSize =PART_CONSTRAINTS.MAX_MULTIPART_PUT_OBJECT_SIZE/ (PART_CONSTRAINTS.MAX_PARTS_COUNT - 1)\n  let requiredPartSize = size /maxPartSize\n  if ((size % maxPartSize) >0) {\n    requiredPartSize++\n  }\n  requiredPartSize = Math.trunc(requiredPartSize)\n  return requiredPartSize\n}\n\n// calculateEvenSplits - computes splits for a source and returns\n// start and end index slices. Splits happen evenly to be sure that no\n// part is less than 5MiB, as that could fail the multipart request if\n// it is not the last part.\n\nlet startIndexParts = []\nlet endIndexParts = []\nexport function calculateEvenSplits(size , objInfo)  {\n  if (size === 0) {\n    return null\n  }\n  const reqParts = partsRequired(size)\n  startIndexParts = new Array(reqParts)\n  endIndexParts = new Array(reqParts)\n\n  let start = objInfo.Start\n  if (_.isEmpty( objInfo.Start) || start === -1 ){\n    start = 0\n  }\n  const divisorValue= Math.trunc(size/reqParts)\n\n  const reminderValue = size%reqParts\n\n  let nextStart = start\n\n  for (let i =0; i < reqParts; i++ ){\n    let curPartSize= divisorValue\n    if (i < reminderValue ){\n      curPartSize++\n    }\n\n    const currentStart =nextStart\n    let currentEnd = currentStart + curPartSize - 1\n    nextStart = currentEnd + 1\n\n    startIndexParts[i]= currentStart\n    endIndexParts[i]=currentEnd\n  }\n\n  return {startIndex:startIndexParts, endIndex:endIndexParts, objInfo:objInfo}\n\n}\n\n\n\nexport function removeDirAndFiles(dirPath, removeSelf) {\n  if (removeSelf === undefined)\n    removeSelf = true\n  try { var files = fs.readdirSync(dirPath) }\n  catch(e) { return }\n  if (files.length > 0)\n    for (var i = 0; i < files.length; i++) {\n      var filePath = path.join(dirPath, files[i])\n      if (fs.statSync(filePath).isFile())\n        fs.unlinkSync(filePath)\n      else\n        removeDirAndFiles(filePath)\n    }\n  if (removeSelf)\n    fs.rmdirSync(dirPath)\n}"],"file":"helpers.js"}